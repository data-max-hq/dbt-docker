#name: Build and Push to GCP Artifact registry
#on:
#  push:
#    branches:
#      - main
#  workflow_dispatch:
#
#env:
#  PROJECT_ID: ${{ secrets.GCP_PROJECT_ID }}
#  REPOSITORY_NAME: transformations-repository
#  IMAGE_NAME: dbt-transformations
#  IMAGE_TAG: ${{ GITHUB_SHA::7 }}
#  GCP_REGION: us-east1
#
#jobs:
#  build-push:
#    runs-on: ubuntu-latest
#    steps:
#      - uses: actions/checkout@v2
#
#      - uses: google-github-actions/auth@v0
#        with:
#          credentials_json: ${{ secrets.GCP_CREDENTIALS }}
#
#      - name: Set up Cloud SDK
#        uses: google-github-actions/setup-gcloud@v0
#
#      - name: Build Docker Image
#        run: docker build -t $IMAGE_NAME:latest .
#
#      - name: Configure Docker Client
#        run: gcloud auth configure-docker $GCP_REGION-docker.pkg.dev --quiet
#
#      - name: Push Docker Image to GCP Artifact Registry
#        run: |-
#          docker tag $IMAGE_NAME:latest $GCP_REGION-docker.pkg.dev/$PROJECT_ID/$REPOSITORY_NAME/$IMAGE_NAME:latest
#          docker tag $IMAGE_NAME:latest $GCP_REGION-docker.pkg.dev/$PROJECT_ID/$REPOSITORY_NAME/$IMAGE_NAME:$IMAGE_TAG
#          docker push $GCP_REGION-docker.pkg.dev/$PROJECT_ID/$REPOSITORY_NAME/$IMAGE_NAME:latest
#          docker push $GCP_REGION-docker.pkg.dev/$PROJECT_ID/$REPOSITORY_NAME/$IMAGE_NAME:$IMAGE_TAG